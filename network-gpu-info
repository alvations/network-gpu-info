#!/bin/sh
# By Jon Dehdari, 2016
# See README.md for details

hosts=$*
cmd="nvidia-smi --query-gpu=utilization.gpu --format=csv | grep -v 'utilization.gpu'"

# If command-line argument is a regular file, process each line in it
if [ -f $hosts ]; then
	for host in $(cat $hosts); do
		echo $host
		ssh $host $cmd
	done
else
	# Otherwise assume command-line arguments are a list of hosts
	for host in $hosts; do
		echo $host
		ssh $host $cmd
	done
fi
